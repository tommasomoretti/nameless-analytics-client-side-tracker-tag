___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Nameless Analytics | CS | Tracker tag",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAAH0CAYAAADL1t+KAAAAAXNSR0IArs4c6QAAAHhlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAAAkAAAAAQAAACQAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAfSgAwAEAAAAAQAAAfQAAAAANGC8/AAAAAlwSFlzAAAFiQAABYkBbWid+gAALlxJREFUeAHt3QmUXWd9GPDRLJIsb2jQNtLYKCCW4IQ1AZqmtCElkNBS4CQpnHCAOiHHgcMWA8Z2vG9gCCkQQkgCNFAKJJgUOC00hHBamgJtIWURgSDwIGmk0WILL7Kl0cyo/2sbaSzNvHnz3n333ft9vzlHR2/u8n3//+970v99d3sDA34IECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBQkcCKivrRDYFSBTZv3vzl48ePP7XURktobMWKFev37NlzsISm7mtibGzs38eLny+rvbLaCfuvR66PL6u9prYTDm+empr6eFPjTyXujRs3PmNwcPDmVPLpNI/hTne0HwEClQg8Mnp5ciU9LaOT4oNLbL45/mT9f0g4XBsGn4g/c/HHT58Eopg/JLqu3b+TqjkGq+5QfwQIJCFwfsxOv5hEJt0l8ZObNm16SXdN2JtAOQIKejmOWiGQnUDMTi+IpKezS/yUhMPh0lg0dMpivxKoXEBBr5xchwSSEdgQmXwpmWw6T+RRca3DhZ3vbk8C5Qgo6OU4aoVArgLFhXFHck1+Xt5vitdZX08wz8LLPgko6H2C1y2BRASKi5G+mkgu3aTx8DiX/vJuGrAvgW4FFPRuBe1PgMATg+Ce3BniXPolYTCSu4P8+yegoPfPXs8EUhFYE1e8fyOVZLrI42HxfISLutjfrgS6ElDQu+KzMwEChUDMTp8Uf92du0Z8sHnjtm3bVuXuIP/+CCjo/XHXK4HUBFZGUf9Oakl1kM/44cOHX9nBfnYh0LWAgt41oQYIECgEYnb6xPhzZ+4a8cHm9Vu3bl2du4P8qxdQ0Ks31yOBVAWG4hGct6aaXLt5xYeasenp6Ve3u73tCJQloKCXJakdAgSKWfrjguFHuVOEw+/GBXJrcneQf7UCCnq13nojkLpA8Q2OU6kn2UZ+G6Oov66N7WxCoDQBBb00Sg0RIPCAwGPi79tpDLx2/fr1Z3EgUJWAgl6VtH4IZCQQs9NDGaW7WKrrhoaGLl5speUEyhZQ0MsW1R4BAsV96Y8IhttypwiHV4+Ojp6Tu4P8qxFQ0Ktx1guB7ASimN2bXdKnJzy6atWqN5y+2BIC5Qso6OWbapEAgRCIw+7j8deB3DHig82r4r704kts/BDoqYCC3lNejRPIXmAud4H4YHPukSNHiq9X9UOgpwIKek95NU4ge4Hi9i2z9BUrXjE+Pj6a/bsBQE8FFPSe8mqcAIE45DxEYeDsubm5yzgQ6KWAgt5LXW0TIFAIjMYsfX/uFGFw0aZNm9bn7iD/3gko6L2z1TIBAicFzjj5MttXZ8bRisuzzV7iPRdQ0HtOrAMCBKKQnR0K2c/Sw+C3N2zYsNE7gkAvBBT0XqhqkwCBhQSKop77zxnDw8NX5o4g/94IKOi9cdUqAQKnCxSH3fedvjivJXEu/cLzzjtvc15Zy7YKAQW9CmV9ECBwn0AUM7duDQysnpmZucpbgkDZAgp62aLaI0BgUYE4lz4SRX3Pohvks+Jl8X3p5+WTrkyrEFDQq1DWBwECJwSiqG868Uu+L1bGfenX5Ju+zHshoKD3QlWbBAi0Eij+35lqtUEO6wYHB18c96VvzSFXOVYjoKBX46wXAgQeLJD9rVtx6mEkjlZc+2AWvxHoXEBB79zOngQIdC6wInZ1X/rAwIvivvTiu+P9EOhaQEHvmlADBAh0KLChw/1S2m14aGjoupQSkkv/BBT0/tnrmQCBgYGDEAZ+Pa54fzQHAt0KKOjdCtqfAIFuBNZ1s3Mi+w7F+fTrE8lFGn0UGO5j37om0LFA/Ad4W+xcu6eOxZXLcx0nle+OhyL1tfmmf1/mL4gr3h87NTX17cwdpN+FgILeBZ5d+yewd+/e5/Sv9+p6jieK/dszzjhjpLoeq+9pdnb2MXFP9t9Fz8WFcrn+DMYV7zdE8s/PFUDe3Qvk/A+oez0tECBQikDMTt8fBe3fldJYcxs5HhfIPWH37t3faG4K/Yl8bGzsBdHzLf3pvT69Ooden7EQCYFsBaKQvTmSn80W4P7EV8SRimKW7odARwIKekdsdiJAoEyBycnJf4z2/qzMNpvYVlwb8q/iivcnNTF2MfdfQEHv/xiIgACBEIjZ6c3x10zuGFHUb8zdQP6dCSjonbnZiwCBkgX27dv3g2jyj0putonNPSuuKXhKEwMXc38FFPT++uudAIF5AnFh3Nvi1+l5i3J9aZae68h3kbeC3gWeXQkQKFdgz549u6Kov7PcVpvXWhj8YpxL/7nmRS7ifgoo6P3U1zcBAqcJTE9Pvz0WHjltRWYL4pqCazNLWbpdCijoXQLanQCBcgUOHjy4N1osinrWP8UsfcuWLb+YNYLklyWgoC+Ly8YECFQhELPTd0Q/h6voq859hMOVdY5PbPUSUNDrNR6iIUAgBOKK9/1x+9ZbYQw8PZ6C9iwOBNoRUNDbUbINAQKVCwwPD78rOr2r8o7r16FZev3GpJYRKei1HBZBESAQzzS/PRRuIjHwc3FfehZfRmSsuxNQ0LvzszcBAj0UOHLkSPGgmR/1sItGNB0XyJmlN2Kk+hukgt5ff70TINBC4NChQ3fEufTrW2ySy6qnxH3pz8slWXl2JqCgd+ZmLwIEKhKI70t/b3R1sKLuattNfLC5orbBCawWAgp6LYZBEAQILCZw4MCBu+OQ87WLrc9o+ZPiXPqvZpSvVJcpoKAvE8zmBAhULzA4OFh8teq+6nuuXY/FLH1F7aISUC0EFPRaDIMgCBBoJRBXvN8b669qtU0O6+JIxePiXPoLc8hVjssXUNCXb2YPAgT6IHDmmWf+h+h2sg9d16rLOJd+eQTk/+5ajUo9gsnm0E08bekfg3xtPdhPRDGzd+/esRO/lfAiPr1/Of7BP6KEpkptYnR0dMv27dtL+1rMGM/PRoBPLjXIEhobGhp69AP3T5fQ2sBA5PmfoqFnltJYiY3Ee+xnp6amJkpssq2m4hzyy2KW+oG2Nk57o5fE/x0fSjvF9rOLfycviK1vaX+PNLccTjOtBbN6aCwdXXBN/xbOlN11/Edb5Liu7Ha7be/o0aOlfniM/9QfErnWLs949nbZM6dz6ziekedQt++JTvaPDxEfjv+8r459H9bJ/gntU8zSiw97swnlJJUuBcr+z6fLcOxOgACBlgLH4sPcZS23yGPlo+No3EvySFWW7Qoo6O1K2Y4AgVoI7Nmz52NxdGZHLYLpYxBxlKT4YJPTUdY+ajejawW9GeMkSgIETgoUh5kvPflrnq/iSMW2OP1wYZ7Zy3ohAQV9IRXLCBCotUCcS/9EBPgPtQ6ymuCKDzYj1XSll7oLKOh1HyHxESCwkMBczFDftNCKzJZtjSv/X55ZztJdREBBXwTGYgIE6i0Q59I/HefSv1HvKHsfXfHB5oILLljZ+570UHcBBb3uIyQ+AgQWEzgexeySxVZmtPy8+Fa6izLKV6qLCCjoi8BYTIBA/QXi4SrFA4a+Wv9IexthXPF+ydatW1f3thet111AQa/7CImPAIGWAlHM3thygwxWxpGKzUeOHHllBqlKsYWAgt4CxyoCBOovsG/fvr+Nc+lfqn+kvY0wivrrx8fHz+htL1qvs4CCXufRERsBAm0JxDP0i68Vzf1nUxyteHXuCDnnr6DnPPpyJ5CIwOTk5Ocjlb9OJJ2O04gjFRdv3LjxzI4bsGOjBRT0Rg+f4AkQmCdw/bzXub5cPzg4+Lpck889bwU993eA/AkkIhBXvH8xZqifTiSdbtJ47bp1687upgH7NlNAQW/muImaAIEFBKKg37DA4twWPXTlypUX55a0fAcGFHTvAgIEkhGIK96/EsnckkxCHSYSH2xes3bt2nM73N1uDRVQ0Bs6cMImQGBhgbh9yyx9YOAhq1evfsPCQpamKqCgpzqy8iKQqUA84/3vI/WPZJr+/LRfdf7556+dv8DrtAUU9LTHV3YEshSI+7FvjMSPZ5n8yaTPmZ6e9o10Jz2Sf6WgJz/EEiSQn0CcS/9WHHr/YH6ZPzjjMHjF5s2b1z14qd9SFVDQUx1ZeREgcFMQzGXOcFZcIHdp5gbZpK+gZzPUEiWQl0CcS/9uZPy+vLJeMNuL4ulxGxZcY2FSAgp6UsMpGQIE5gvMzs6+JX6fmb8sw9dr4ulxl2eYd3YpK+jZDbmECeQjsH///u/HeeT35pPxopn+djw9bmzRtVYkIaCgJzGMkiBAoIXAzbFuusX6HFatjqfH+Ua6xEdaQU98gKVHIHeBOJe+MwzenbtDXBx34ZYtW8Zzd0g5fwU95dGVGwEC9wkMDw+/LV4cyZxjVdyff2XmBkmnr6AnPbySI0CgENi1a9eemKG+I3eNuJ7gZWNjYw/L3SHV/BX0VEdWXgQIPEggCvrbY8E9D1qY2S9hMBJF/erM0s4mXQU9m6GWKIG8BeLpcfujmBWH3rP+iaL+4rgv/eFZIySavIKe6MBKiwCB0wWioL8zlt51+pqslgzHfenXZJVxJskq6JkMtDQJEBgYmJycvC0ciofN5P7zorji/VG5I6SWv4Ke2ojKhwCBlgJHjhz5w9jgRy03Sn/lUDxFzyw9sXFW0BMbUOkQINBa4NChQ3fEeeTi61Wz/onTD78eV7z/ZNYIiSWvoCc2oNIhQGBpgZmZmT+OrYrD7zn/FP//X5czQGq551TQi69RrOOfst9TdcxxbtWqVcfLTDQekFHLPGPWU2qe0V4WeZb53minrYMHDxYXxilmAwMviCvef7odM9vUX2BF/UMUIQECBMoX2Lx585o49P6DaHlj+a03qsVP7t2793mNiviUYOPUwQti0S2nLM7u15xm6NkNroQJEFhcIJ7xfk8UdBeGDQw8N654f8LiUtY0RUBBb8pIiZMAgdIFVq9e/YFodLL0hpvV4Ir4YHN9s0IW7UICCvpCKpYRIJCFwMTExJG4TuGqLJJtkWQU9OfEYeufabGJVQ0QUNAbMEhCJECgdwJr1679ULT+w9710JiWb2hMpAJdUEBBX5DFQgIEchHYvn37dOR6RS75tsjzl+KK96e1WG9VzQUU9JoPkPAIEOi9QFzl/ZE49P793vdU7x6GhobM0us9RC2jU9Bb8lhJgEAmAjOR5+WZ5LpomnEu/RlxLv2fLbqBFbUWUNBrPTyCI0CgKoG4je0vo6/vVNVfjfu5tsaxCa2FgILeAscqAgSyEpiLw+6XZpXxwsn+i3jozr9ceJWldRZQ0Os8OmIjQKBSgZilfzKK+jcr7bSGncWh9+xv5avhsCwZkoK+JJENCBDISOB4fE3AmzLKd7FUfz7OpT97sZWW11NAQa/nuIiKAIE+CUxNTf3X6Pprfeq+Nt164E5thqLtQBT0tqlsSIBALgJRzC7JJdfF8ozD7k+Lc+n/erH1ltdPQEGv35iIiACBPgvEufS/iaL+5T6H0ffuo6hf2fcgBNC2gILeNpUNCRDISSDOpV+WU76L5PozcS79+Yuss7hmAgp6zQZEOAQI1EMgzqV/ISL5m3pE09coiln6ir5GsETncTRldolNslitoGcxzJIkQKBDges63C+l3Z6wadOmX61zQrPxU+f4qopNQa9KWj8ECDROIJ7x/j8i6OKq96x/YgZc61n64OBg8eje7H8U9OzfAgAIEGglEOfSzdIHBn4qrnh/USunfq5zyP1+/eF+DoK+yxeIC1g+G61uLb/l7lqMmc5PRwvHumvl5N7xn8vH4grcx59cUo9Xq1atetrExMSPSoxmKNqq4wfv0sayRKueNLVv374vx7+r/xyNP68nHTSk0fj3dkWE+tH4M1e3kItD7jFLr1tYlcejoFdO3vMOHx49PLLnvSyzg23btg3u2LFjmXu13PxhsfbRLbfow8rp6elS/01FIflUpPErfUilZZfx/+e2/fv3f7/lRgmtjBngdVHQsi7oMZyPiXPpL46LBT9Yt6F1yP3+EfGRpm7vTPEQIFA7gbgv/WtR1P+idoFVH1AxSy+OGtXqJwp6NkeMWsEr6K10rCNAgMADAnFU4vp4eTxnkPhQsy1Od720hgb31jCmykNS0Csn1yEBAk0UiHPpxbewfbiJsZcZc5x6uDzaK/XUUrfxRUwKeiAq6N2+k+xPgEA2AjFDvSGSrd1FYRUPwMPj2o7frLjPpbq7Z6kNclivoOcwynIkQKAUgTiX/p1o6AOlNNbsRi694IILVtYoBTP0GAwFvUbvSKEQIFB/gTiXflNEmfuDTB522223vbwuoxVjoqDHYCjodXlHioMAgUYIFLfrxaH3P21EsD0MMgzeFLejruphF203Hdc3KOihpaC3/ZaxIQECBO4XiNukinPp05l7jB8+fPh3amJQXNdwtCax9C0MBb1v9DomQKCpArt3756M2N/T1PjLijtm6W8cHx8/o6z2umznri73b/zuCnrjh1ACBAj0Q2BoaOit0e+RfvRdlz7jdrGxmZmZV9YknjtrEkffwlDQ+0avYwIEmixQzNJjhvquJudQRuxh8IZ42MyaMtrqsg0FvUtAuxMgQCBbgZid/n4kn/s90BvC4NU1eBPcUYMY+hqCGXpf+XVOgECTBeKK930R/x80OYcyYo9D7xevX7/+rDLa6rSNiMEMvVM8+xEgQIBA3Co0OFgU9NwvyFoX1xS8rp/vhzj0r6D3cwD0TYAAgaYLTE5O3hazw7c1PY9u44+C+rrR0dFzum2n0/0VdPehd/resR8BAgROCKxevfqd8cuhEwvyfLE2HC7uV+pzc3Nm6P3C1y8BAgRSEZiYmPhRzBBvTiWfLvJ4zfnnn7+2i/073jVOfdze8c6J7OiiuEQGUhoECPRXYHp6+t0RwW39jaK/vceph3OPHTv2+j5FoaD3CV63BAgQSErg4MGDxYVxNyaVVGfJvGrLli0P7WzXzveKDxNZf5gq5MzQO3//2JMAAQIPEojD7n8cC/Y/aGF+v5wdxfWSqtOOPs3Qq0bXHwECBFIViO9LvycKy7Wp5tduXmHwik2bNq1vd/sytlPQzdDLeB9pgwABAicE4krv90Vx2XNiQZ4vzoyjFZdWmfrIyIgZepXg+iJAgEDqAnHF+5EoZlennmcb+V0UT4/b1MZ2ZW2ioJclqR0CBAgQuF8gHrDy5/FqZ+YeZ8TT4y6vyiC+LOfe6Cvrb79zUVxV7zb9ECCQjcD27dun47D7ldkkvEiicaTit+KK9/FFVvdi8cFeNNqUNhX0poyUOAkQaJTA1NTUh6Ogfb9RQZcf7Op4gltls/QIP+s7DBT08t/AWiRAgEAhMBN/rkAxcGF8X/r5FTkU336X7Y+Cnu3QS5wAgV4LxG1sfxF9fLfX/dS8/ZVx+qGSDzbRz1TNLXoanoLeU16NEyCQucBs5F/lIedacseph5du3LjxJ3odXPRjht5rZO0TIEAgV4G9e/d+InL/Vq75F3nHzHkkrni/qgIDBb0CZF0QIEAgV4HjMXO8LNfkf5x3FPXfGB8f3/bj33vxtxl6L1S1SYAAAQInBOJc+qfjl6+dWJDni+HZ2dmre5l6tG+G3ktgbRMgQIDAfQLZz9JD4YVxxftjevV+MEPvlax2CRAgQOCEQJxL/29RcL5yYkGeL4bivvSre5X64OCgGXqvcLVLgAABAg8SqOT2rQf1WLNf4kPNr8U3sV3Qi7Di1EbxnejF/f9Z/rhtLcthlzQBAv0QiILzuShof9uPvmvU52AYXNujeIoLEA/0qO3aNztc+wgFuCyB+FKInzp8+HDtPqjt2LHj6LISWWLjtWvXPr2OeRbftLVE6MtaXTwoI/6DunVZO1Ww8fDw8LEKukmyizjkfG2M6TOSTK79pJ4fz3h//OTk5Nfb36W9LePfTHHYfay9rdPaakVa6ciGAAEC9RcYGxv7TET57PpH2rsIo/B+Kp53/2/K7iFsPxttPqvsdpvQXu1mck1AEyMBAgS6EYiLt3p1yLmbsCrdN45SPDeK75N70Gm2F8Yp6D14N2mSAAECrQTiUPOXihlqq20yWXdd2XnGBwUFvWxU7REgQIDA4gJReLKfpYfOL8cz3p+6uNLy18Q1Cgr68tnsQYAAAQKdCsR96V+NfT/e6f6p7BenH0qdpZuhp/LOkAcBAgQaJBCzyWsi3OMNCrkXoT4znh73T8tqOAp6tl+h6hx6We8i7RAgQGCZAvv27Su+he0jy9wtxc3LnKXvShGonZwU9HaUbEOAAIHeCVwfTc/1rvn6txwXCP5CPD3un5cRaXxBy+4y2mliGwp6E0dNzAQIJCMQ59L/IQ4TfzCZhDpMpKyLBOOox+EI4fYOw2j0bgp6o4dP8AQIpCAQF4bdEHlk+wzyB8bw6XEu/ZkljWeWh90V9JLePZohQIBApwK7d+/eEfu+v9P9U9nvgYsEu04nZvsKeteKGiBAgACBTgVujEKU9TPyI/9/EufSf7lTwHn7KejzMLwkQIAAgQoF4lz6D2OG+t4Ku6xlV1HUi1v5uvqJi+wU9K4E7UyAAAECXQnEt9i9ORoo9ZsJuwqoPzv/bJxLf26XXSvoXQLanQABAgS6EIhz6ZMxQ/3DLppIYteYYV8diXT8baBm6Em8DSRBgACBZgvMzMy8NTK4p9lZdB39E+Ob2J7faSsKeqdy9iNAgACB0gT2799ffLnIO0prsKENRVG+KkLvaJa+bt264uEy2T1S121rDX2zC5sAgXQF4rD72yO7u9PNcOnMwuBxccX7ry295elbbN++fTqW7j99TdpLFPS0x1d2BAg0UGDPnj0Ho6D9fgNDLzXkMChm6Z3WqZ2lBtOAxjqFakBqQiRAgEBzBeKK93dEQbujuRmUEvlj41z6izpsKbsr3YcD694OsXq52764J3NrmR3EoZvi6tHRMtssoa2ZyPPsEto50USM5zfjl20nFtTkxejo6LkPHAYrJaLI879HQ08ppbESG4lHeI5PTk7eVlaTkedfRVvPLqu9stqJ+6UfG8/MvrWs9rRzusDOnTsPxfjfHGuKx8Lm/HNlJP/R+DO7TIT8CnoArV4mUhWblx5TFPOizdLb7RKjF89uXlXDPAeOHj3a0cUti/nGeK6Ki2bqNp4DEVOpeUb+K+s4npGno3uLvTlLXH7s2LF3jYyMXBxN1m0yUmKWSzb1qJiQvXhqaurPl9xy3gbxHt0V/0/MW5L+S/8o0x9jGRIg0FCBgwcP3hWF6aaGhl9a2HHk64pobHiZDWY3Q1fQl/kOsTkBAgSqFIiC/p7or7iVLdufMHhEPD3upcsBGBoaUtCXA2ZbAgQIEOitQPH93nHo+Mbe9lL/1qOo/15EOdJupHGab6LdbVPZzgw9lZGUBwECyQqsXLnyT6Kg7Uk2wfYS2xoXCf5me5sODMTpiqnYNqvn4ivo7b47bEeAAIE+CUxMTByJWfp1feq+Tt1etm3btuLC33Z+iifF/bCdDVPZRkFPZSTlQYBA0gJx6+f7I8GdSSe5dHLn3XPPPS9ferMTW0yceJXBCwU9g0GWIgECzRconuMQs/Rrmp9JdxnEMxAu3bp1a7u3rE5011uz9lbQmzVeoiVAIGOBeCTsByP9H2RMMBAfajbHBW+/06bBRJvbJbGZgp7EMEqCAIFMBIqHURVPTsv955K4jW3NUghR/CeW2ial9Qp6SqMpFwIEkheIx0V/NJL8bvKJtk5wYxx6f2XrTeK7VxX0pYisJ0CAAIE+CszGLWzFk9Oy/oli/cb169ef1Qoht3vRzdBbvRusI0CAQA0F4rnmt0RY36phaFWGtC6+ke5VrTrM7V50Bb3Vu8E6AgQI1FNgLmaoxZPTcv95fdzOd04LhKzuRVfQW7wTrCJAgEBdBeKK909FbH9f1/gqims0nqL32iX6mlhifTKrFfRkhlIiBAhkJhCn0o9fnlnOp6UbRypeF/elP+S0FScXZPO0OAX95KB7RYAAgUYJxLn0z0TA/7tRQZcf7EOmp6d/t0WzEy3WJbVKQU9qOCVDgEBuAvFd4ZfllvOp+caRiteMj4+Pnrq8+D2nW9cU9IXeAZYRIECgIQKTk5Ofj1D/Z0PC7VWY58zOzr5+kcYnFlme3GIFPbkhlRABAhkKZD9LjzF/1aZNm9afOvZDQ0MTpy5L9XcFPdWRlRcBAtkIxNPjvhjJfi6bhBdO9Kw4/fDGU1ft2rVrbyzL4nvRFfRTR9/vBAgQaKBAnCu+uoFhlxpynEt/xYYNGzae0mhxL/rOU5Yl+auCnuSwSooAgdwE4r70/xVF/b/klvcp+a6JQ+xvOmVZ8evEAsuSW6SgJzekEiJAIFeBmKFenWvu8/K+6Lzzzts87/fi5cQpvyf5q4Ke5LBKigCBHAXiXPr/jbz/Ksfc5+W8Oq54P/UiwSweLqOgz3sXeEmAAIGmC8SFYddEDsV542x/4kjFb8X3pZ83D2Bi3utkXyroyQ6txAgQyFEg7kv/ehS0j+WY+7ycV4XBicfi5vJwGQV93jvASwIECKQg8MAsfS6FXDrNIYr4hXFf+tZi//CYKP5O/UdBT32E5UeAQHYCccX7dyLp/5hd4vMSjhn6SBT1+75idvfu3cW96NPzVif5UkFPclglRYBA7gJx+9b1YTCbucNL4770R4RB8f3xu1K3UNBTH2H5ESCQpUDMSr8XiX8gy+RPJj0cH2yuLH6dm5ubOLk4zVcKeprjKisCBAgMxGHnG2Jmeixzit/YsmXLo8Ig+VvXFPTM3+nSJ0AgXYH4vvSJyO5P082wrcyGYnZ+VWw50dbWDd5IQW/w4AmdAAECSwnEDP2m2CaLLydpYfHCWHdmi/VJrFLQkxhGSRAgQGBhgbgvfXesec/Ca7NZOhgfbF6cerYKeuojLD8CBLIXmJmZeUsg3Js5xJbU8x+OBO+sW5JxIcddPYipyLPIt04/Mz0I5u5os3ZjumrVqrIfRXm4jnnGAyzKfpjHPXXMM2Y7ZefZg38KmvyxwIEDB6biISvvinE77fvCf7yNv5svsKL5KciAAAECBJYSiGebr4vJ0q2x3VlLbWt9MwWGmhm2qAkQIEBgOQJ33XXXPWefffaa2Ofpy9nPts0RcA69OWMlUgIECHQlMDIy8vY47H5HV43YubYCZui1HRqBESBAoFyBO+6448iZZ55ZPOP8F8ptWWt1EHAOvQ6jIAYCBAhUJDA6OnpOXKRanEsfrahL3VQkYIZeEbRuCBAgUAeBe++99+g555xThPLMOsQjhvIEnEMvz1JLBAgQaITA7OzsuyPQA40IVpBtC5iht01lQwIECKQhcPjw4WNxxXvxpS3PTiMjWRQCZujeBwQIEMhQIL5W9L1xcdzeDFNPNmUz9GSHVmIECBBYXODOO++ciSve742i/pzFt7KmSQJm6E0aLbESIECgRIGzzjrrfdHcrhKb1FQfBczQ+4ivawIECPRT4Pbbb5+NK96L7854bj/j0Hc5Au5DL8dRKwQIEGiqwMjY2Nh3I/ifaGoC4r5fwCF37wQCBAjkLXAsvrTl6rwJ0sjeDD2NcZQFAQIEuhEYiln6t6OBR3XTiH37K2CG3l9/vRMgQKAOArNxtftVdQhEDJ0LmKF3bmdPAgQIpCQwGLP0b0RCF6SUVE65mKHnNNpyJUCAwOICc7HqysVXW1N3ATP0uo+Q+AgQIFCdwIqYpX8tuntCdV3qqSwBM/SyJLVDgACB5gscn5ubu6L5aeSZQTYz9I0bN54Zb9Ra5Ts4OHh83759h8t8623evHnNsWPHavdB7cCBA3eXmef4+PgZR48erd2DkcrOc+vWravjizSGy7Qro63Is3jfHi+jLW3UTyBm6V+JqJ5Sv8hE1Eqgdv9RtAq2m3VRPHfGn9Fu2ujBvjPR5kiZ7cb9pP9veHj4kWW2WUZb27ZtW71jx46jZbRVtBEfzr4QeT61rPbKaic+UK3fs2fPwbLaiw8tt0Sev1JWe2W1s2HDhm379+//flntaadeAnHF++/F/yV/Xa+oRLOUQO1mcksFbD0BAgQI9FYgPpR+Lnr4u972ovWyBRT0skW1R4AAgQQEYobuXHrDxlFBb9iACZcAAQJVCExNTX0hivrnq+hLH+UIKOjlOGqFAAECyQnEdUeeHtegUVXQGzRYQiVAgECVAnEuvTiP/pkq+9RX5wIKeud29iRAgEDyAnHY3Sy9IaOsoDdkoIRJgACBfgjEufT/E/1+sh9963N5Agr68rxsTYAAgewEHjiX7kFCNR95Bb3mAyQ8AgQI9FtgcnLy6/GwmY/3Ow79txZQ0Fv7WEuAAAECIRBPZ7y6+AtGfQUU9PqOjcgIECBQG4E4l/7tCOYjtQlIIKcJKOinkVhAgAABAgsJDA0NXRPLZxdaZ1n/BRT0/o+BCAgQINAIgd27d38vbmP7YCOCzTBIBT3DQZcyAQIEOhWIgn5dXCB3rNP97dc7AQW9d7ZaJkCAQHIC+/btuzWK+vuSSyyBhBT0BAZRCgQIEKhSIGboN0Z/R6vsU19LCyjoSxvZggABAgTmCcQz3nfFr++dt8jLGggo6DUYBCEQIECgaQLHjh17c8R8b9PiTjleBT3l0ZUbAQIEeiRw8ODBvXHo/d09al6zHQgo6B2g2YUAAQIE7nt63M3hcDeLeggo6PUYB1EQIECgcQLx9LgDEfQ7Gxd4ogEr6IkOrLQIECBQhcDIyMjbop87q+hLH60FFPTWPtYSIECAQAuBnTt3Hor70t/eYhOrKhJQ0CuC1g0BAgRSFZienv6DyO1Qqvk1JS8FvSkjJU4CBAjUVOD2228vDrm/tabhZROWgp7NUEuUAAECvROYmZl5V7ReXCTnp08CCnqf4HVLgACBlAQOHDhwd5xLf0tKOTUtFwW9aSMmXgIECNRUYHh4+I/iYTN7axpe8mEp6MkPsQQJECBQjUB8X3rxKNibqulNL6cKKOinividAAECBDoWWLNmzZ/EzsWXt/ipWEBBrxhcdwQIEEhZYMeOHcXXql6fco51zU1Br+vIiIsAAQINFdi7d+8HIvRbGxp+Y8NW0Bs7dAInQIBAbQWOxRXv19Y2ukQDU9ATHVhpESBAoJ8C8cUtH4r+v9fPGHLrW0HPbcTlS4AAgWoEZuMWtqur6UovhYCC7n1AgAABAj0R2LNnz0ej4W/3pHGNniYwfNqSdBd8Oz4tnlun9OIc00zZ8USO3402j5TdbrftxZWvc922MX//sNsRua6Zv6wOr1euXFnqmEaOE5HXN+uQ2/wY4isziyuZ/RBYSmAu/q1eFe/jv1xqQ+u7F1jRfRNaIECAAAECiwqsGBsbuyzWnrHoFlYQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAQLME/j+dHohhvivoygAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "A highly customizable GTM custom template designed to send requests to Nameless Analytics Server-side client tag.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "LABEL",
    "name": "event_data_title",
    "displayName": "\u003cb\u003eData\u003c/b\u003e"
  },
  {
    "type": "GROUP",
    "name": "event_data",
    "displayName": "Event data",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "RADIO",
        "name": "event_type",
        "displayName": "Event type",
        "radioItems": [
          {
            "value": "standard",
            "displayValue": "Standard event",
            "subParams": [],
            "help": "Standard event name. \n\u003c/br\u003e\u003c/br\u003e\nPlease use:\u003c/br\u003e\n\u003cul\u003e\n  \u003cli\u003e\n    \u003cb\u003epage_view\u003c/b\u003e when a page is viewed. Use this event for both standard and virtual pageviews.\u003c/br\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\n    \u003cb\u003econsent_given\u003c/b\u003e when the user gives consent to improve the accuracy of consent metrics.\n  \u003c/li\u003e\n  \u003cli\u003e\n    \u003cb\u003epage_load_time\u003c/b\u003e when a page is loaded to calculate page speed metrics.\n  \u003c/li\u003e\n  \u003cli\u003e\n    \u003cb\u003epage_closed\u003c/b\u003e when a page is closed to improve the accuracy of \u003ci\u003esession_duration\u003c/i\u003e, \u003ci\u003etime_on_page\u003c/i\u003e and other metrics.\n  \u003c/li\u003e\n\u003c/ul\u003e"
          },
          {
            "value": "custom",
            "displayValue": "Custom event",
            "subParams": [],
            "help": "Custom event name.\n\u003c/br\u003e\u003c/br\u003e\nTo maintain consistency between events, it is highly recommended to use \u003cb\u003esnake_case\u003c/b\u003e notation style (with underscores between words) to create descriptive and easily interpretable names.\u003cbr\u003e\u003cbr\u003e\n\nExamples:\u003cbr\u003e\n\u003cul\u003e\n  \u003cli\u003ebutton_clicked\u003c/li\u003e\n  \u003cli\u003eform_submitted\u003c/li\u003e\n  \u003cli\u003evideo_played\u003c/li\u003e\n\u003c/ul\u003e\u003cbr\u003e\n\nAvoid:\u003cbr\u003e\n\u003cul\u003e\n  \u003cli\u003eSpaces: button clicked\u003c/li\u003e\n  \u003cli\u003eHyphens: button-clicked\u003c/li\u003e\n  \u003cli\u003eCamelCase: ButtonClicked\u003c/li\u003e\n\u003c/ul\u003e"
          }
        ],
        "simpleValueType": true,
        "subParams": [],
        "defaultValue": "standard",
        "help": "Select a name for the event.\u003c/br\u003e\u003c/br\u003eChoose between standard events and custom events, use standard events when possible."
      },
      {
        "type": "SELECT",
        "name": "standard_event_name",
        "displayName": "Event name",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "page_view",
            "displayValue": "page_view"
          },
          {
            "value": "consent_update",
            "displayValue": "consent_update"
          },
          {
            "value": "page_load_time",
            "displayValue": "page_load_time"
          },
          {
            "value": "page_closed",
            "displayValue": "page_closed"
          }
        ],
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "alwaysInSummary": true,
        "defaultValue": "page_view",
        "enablingConditions": [
          {
            "paramName": "event_type",
            "paramValue": "standard",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "custom_event_name",
        "displayName": "Event name",
        "simpleValueType": true,
        "alwaysInSummary": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          },
          {
            "type": "REGEX",
            "args": [
              "^(?!page_view$).*"
            ],
            "errorMessage": "Please use standard event name for page_view.",
            "enablingConditions": []
          },
          {
            "type": "REGEX",
            "args": [
              "^(?!consent_update$).*"
            ],
            "errorMessage": "Please use standard event name for consent_update."
          },
          {
            "type": "REGEX",
            "args": [
              "^(?!page_load_time$).*"
            ],
            "errorMessage": "Please use standard event name for page_load_time."
          },
          {
            "type": "REGEX",
            "args": [
              "^(?!page_closed$).*"
            ],
            "errorMessage": "Please use standard event name for page_closed."
          }
        ],
        "valueHint": "(not set)",
        "enablingConditions": [
          {
            "paramName": "event_type",
            "paramValue": "custom",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "add_parameters",
        "checkboxText": "Add/override event level parameters",
        "simpleValueType": true,
        "displayName": "Event parameters",
        "alwaysInSummary": true,
        "defaultValue": false,
        "help": "Add or override event parameters to the request in event_data. If a parameter has the same name, it will be overridden.\n\u003c/br\u003e\u003c/br\u003e\nReserved event parameters: \u003c/br\u003e \n• event_type \u003c/br\u003e \n• channel_grouping \u003c/br\u003e \n• source \u003c/br\u003e \n• campaign \u003c/br\u003e \n• campaign_id \u003c/br\u003e \n• campaign_term \u003c/br\u003e \n• campaign_content \u003c/br\u003e \n• page_id \u003c/br\u003e \n• page_title \u003c/br\u003e \n• page_hostname_protocol \u003c/br\u003e \n• page_hostname \u003c/br\u003e \n• page_location \u003c/br\u003e \n• page_fragment \u003c/br\u003e \n• page_query \u003c/br\u003e \n• page_extension \u003c/br\u003e \n• page_referrer \u003c/br\u003e \n• page_language \u003c/br\u003e \n• page_status_code \u003c/br\u003e \n• cs_container_id \u003c/br\u003e \n• user_agent \u003c/br\u003e \n• browser_name \u003c/br\u003e \n• browser_language \u003c/br\u003e \n• browser_version \u003c/br\u003e \n• device_type \u003c/br\u003e \n• device_vendor \u003c/br\u003e \n• device_model \u003c/br\u003e \n• os_name \u003c/br\u003e \n• os_version \u003c/br\u003e \n• screen_size \u003c/br\u003e \n• viewport_size \u003c/br\u003e \n• country \u003c/br\u003e \n• city \u003c/br\u003e \n• ss_hostname \u003c/br\u003e \n• ss_container_id \u003c/br\u003e",
        "subParams": [
          {
            "type": "SIMPLE_TABLE",
            "name": "add_event_params",
            "displayName": "Event parameters",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Param name",
                "name": "param_name",
                "type": "TEXT",
                "valueHint": "(not set)",
                "isUnique": true,
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!event_type$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override event_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!channel_grouping$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override channel_grouping parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!source$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_term$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_term parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_content$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_content parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_title$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_title parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_hostname_protocol$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_hostname_protocol parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_hostname$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_hostname parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_location$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_location parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_fragment$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_fragment parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_query$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_query parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_extension$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_extension parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_referrer$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_referrer parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_language$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_status_code$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_status_code parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!cs_container_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override cs_container_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_agent$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_agent parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!browser_name$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override browser_name parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!browser_language$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override browser_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!browser_version$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override browser_version parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!device_type$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override device_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!device_vendor$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override device_vendor parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!device_model$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override device_model parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!os_name$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override os_name parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!os_version$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override os_version parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!screen_size$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override screen_size parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!viewport_size$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override viewport_size parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!country$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override country parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!city$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override city parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!ss_hostname$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override ss_hostname parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!ss_container_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override ss_container_id parameter."
                  }
                ]
              },
              {
                "defaultValue": "",
                "displayName": "Param value",
                "name": "param_value",
                "type": "TEXT",
                "valueHint": "(not set)",
                "isUnique": false,
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  }
                ]
              }
            ],
            "alwaysInSummary": true,
            "enablingConditions": [
              {
                "paramName": "add_parameters",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "remove_parameters",
        "checkboxText": "Remove event level parameters",
        "simpleValueType": true,
        "displayName": "",
        "alwaysInSummary": true,
        "defaultValue": false,
        "help": "Remove event parameters from the request in event_data. If a parameter has the same name, it will be overridden.\n\u003c/br\u003e\u003c/br\u003e\nReserved event parameters: \u003c/br\u003e \n• event_type \u003c/br\u003e \n• channel_grouping \u003c/br\u003e \n• source \u003c/br\u003e \n• campaign \u003c/br\u003e \n• campaign_id \u003c/br\u003e \n• campaign_term \u003c/br\u003e \n• campaign_content \u003c/br\u003e \n• page_id \u003c/br\u003e \n• page_title \u003c/br\u003e \n• page_hostname_protocol \u003c/br\u003e \n• page_hostname \u003c/br\u003e \n• page_location \u003c/br\u003e \n• page_fragment \u003c/br\u003e \n• page_query \u003c/br\u003e \n• page_extension \u003c/br\u003e \n• page_referrer \u003c/br\u003e \n• page_language \u003c/br\u003e \n• page_status_code \u003c/br\u003e \n• cs_container_id \u003c/br\u003e \n• user_agent \u003c/br\u003e \n• browser_name \u003c/br\u003e \n• browser_language \u003c/br\u003e \n• browser_version \u003c/br\u003e \n• device_type \u003c/br\u003e \n• device_vendor \u003c/br\u003e \n• device_model \u003c/br\u003e \n• os_name \u003c/br\u003e \n• os_version \u003c/br\u003e \n• screen_size \u003c/br\u003e \n• viewport_size \u003c/br\u003e \n• country \u003c/br\u003e \n• city \u003c/br\u003e \n• ss_hostname \u003c/br\u003e \n• ss_container_id \u003c/br\u003e",
        "subParams": [
          {
            "type": "SIMPLE_TABLE",
            "name": "remove_event_params",
            "displayName": "Event parameters",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Param name",
                "name": "param_name",
                "type": "TEXT",
                "valueHint": "(not set)",
                "isUnique": true,
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!event_type$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override event_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!channel_grouping$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override channel_grouping parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!source$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_term$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_term parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_content$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_content parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_title$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_title parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_hostname_protocol$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_hostname_protocol parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_hostname$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_hostname parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_location$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_location parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_fragment$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_fragment parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_query$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_query parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_extension$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_extension parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_referrer$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_referrer parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_language$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_status_code$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_status_code parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!cs_container_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override cs_container_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_agent$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_agent parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!browser_name$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override browser_name parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!browser_language$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override browser_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!browser_version$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override browser_version parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!device_type$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override device_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!device_vendor$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override device_vendor parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!device_model$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override device_model parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!os_name$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override os_name parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!os_version$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override os_version parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!screen_size$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override screen_size parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!viewport_size$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override viewport_size parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!country$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override country parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!city$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override city parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!ss_hostname$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override ss_hostname parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!ss_container_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override ss_container_id parameter."
                  }
                ]
              }
            ],
            "alwaysInSummary": true,
            "enablingConditions": [
              {
                "paramName": "remove_parameters",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "add_parameters_from_dataLayer",
        "checkboxText": "Add event level parameters from dataLayer",
        "simpleValueType": true,
        "displayName": "",
        "alwaysInSummary": true,
        "defaultValue": false,
        "help": "Add event parameters from the dataLayer.push() event that has triggered the tag.\u003cbr\u003e\u003c/br\u003e\n\nThis parameters can\u0027t be added: \u003c/br\u003e\n• event_type \u003c/br\u003e \n• channel_grouping \u003c/br\u003e \n• source \u003c/br\u003e \n• campaign \u003c/br\u003e \n• campaign_id \u003c/br\u003e \n• campaign_term \u003c/br\u003e \n• campaign_content \u003c/br\u003e \n• page_id \u003c/br\u003e \n• page_title \u003c/br\u003e \n• page_hostname_protocol \u003c/br\u003e \n• page_hostname \u003c/br\u003e \n• page_location \u003c/br\u003e \n• page_fragment \u003c/br\u003e \n• page_query \u003c/br\u003e \n• page_extension \u003c/br\u003e \n• page_referrer \u003c/br\u003e \n• page_language \u003c/br\u003e \n• page_status_code \u003c/br\u003e \n• cs_container_id \u003c/br\u003e \n• user_agent \u003c/br\u003e \n• browser_name \u003c/br\u003e \n• browser_language \u003c/br\u003e \n• browser_version \u003c/br\u003e \n• device_type \u003c/br\u003e \n• device_vendor \u003c/br\u003e \n• device_model \u003c/br\u003e \n• os_name \u003c/br\u003e \n• os_version \u003c/br\u003e \n• screen_size \u003c/br\u003e \n• viewport_size \u003c/br\u003e \n• country \u003c/br\u003e \n• city \u003c/br\u003e \n• ss_hostname \u003c/br\u003e \n• ss_container_id \u003c/br\u003e\n• ecommerce \u003c/br\u003e"
      },
      {
        "type": "CHECKBOX",
        "name": "add_ecommerce",
        "checkboxText": "Add ecommerce data",
        "simpleValueType": true,
        "displayName": "",
        "alwaysInSummary": true,
        "defaultValue": false,
        "help": "Add ecommerce data from dataLayer or custom variable.",
        "subParams": [
          {
            "type": "RADIO",
            "name": "ecommerce_method",
            "displayName": "From:",
            "radioItems": [
              {
                "value": "from_datalayer",
                "displayValue": "dataLayer",
                "help": "Add ecommerce data from an ecommerce object in the current dataLayer push.\n\u003c/br\u003e\u003c/br\u003e\nExample:\u003c/br\u003e \ndataLayer.push{(\u003c/br\u003e\n\u0026nbsp \u0026nbsp  event : \"purchase\", \u003c/br\u003e\n\u0026nbsp \u0026nbsp  ecommerce: { \u003c/br\u003e\n\u0026nbsp \u0026nbsp \u0026nbsp \u0026nbsp // ecommerce values \u003c/br\u003e\n\u0026nbsp \u0026nbsp } \u003c/br\u003e\n)}"
              },
              {
                "value": "from_custom_variable",
                "displayValue": "Custom variable",
                "help": "Add ecommerce data from a custom variable in JSON format.\n\u003c/br\u003e\u003c/br\u003e\n\u003cb\u003eReporting queries must be modify accordingly to the custom ecommerce JSON schema.\u003c/b\u003e",
                "subParams": [
                  {
                    "type": "TEXT",
                    "name": "ecommerce_custom_variable",
                    "displayName": "",
                    "simpleValueType": true,
                    "alwaysInSummary": true,
                    "valueValidators": [
                      {
                        "type": "NON_EMPTY"
                      }
                    ],
                    "valueHint": "(not set)"
                  }
                ]
              }
            ],
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "add_ecommerce",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "settings_title",
    "displayName": "\u003c/br\u003e\u003cb\u003eSettings\u003c/b\u003e"
  },
  {
    "type": "GROUP",
    "name": "config_variable_settings",
    "displayName": "Configuration variable settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "config_variable",
        "displayName": "Configuration variable",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "alwaysInSummary": true,
        "help": "Select a Nameless Analytics Client-Side tracker configuration variable."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "advanced_settings",
    "displayName": "Advanced settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "disable_this_log",
        "checkboxText": "Disable logs in JavaScript console for this event",
        "simpleValueType": true,
        "displayName": "",
        "alwaysInSummary": true,
        "defaultValue": false,
        "help": "Disables logging on browser console for this specific event.",
        "enablingConditions": []
      }
    ],
    "help": "Lorem ipsum"
  },
  {
    "type": "GROUP",
    "name": "credits",
    "displayName": "Info",
    "subParams": [
      {
        "type": "LABEL",
        "name": "info",
        "displayName": "\u003cb\u003eNameless Analytics Client-Side tracker tag\u003c/b\u003e\u003c/br\u003e\nBeta version: 1.0. \n\u003c/br\u003e\nRead more about the \u003ca href\u003d\"https://github.com/tommasomoretti/nameless-analytics\" target\u003d\u0027_blank\u0027 rel\u003d\"noopener\"\u003eNameless Analytics project\u003c/a\u003e or the \u003ca href\u003d\"https://github.com/tommasomoretti/nameless-analytics-client-tag\" target\u003d\u0027_blank\u0027 rel\u003d\"noopener\"\u003eClient-side Tracker Tag\u003c/a\u003e. \n\u003c/br\u003e\nCreated by \u003ca href\u003d\"https://tommasomoretti.com/?utm_source\u003dtagmanager.google.com\u0026utm_medium\u003dreferral\u0026utm_campaign\u003dcs_analytics_tag\" target\u003d\u0027_blank\u0027 rel\u003d\"noopener\"\u003eTommaso Moretti\u003c/a\u003e\n\u003c/br\u003e\u003c/br\u003e"
      }
    ],
    "groupStyle": "ZIPPY_OPEN"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const getTimestampMillis = require('getTimestampMillis');
const queryPermission = require('queryPermission');
const injectScript = require('injectScript');
const callInWindow = require('callInWindow');
const getUrl = require('getUrl');
const readTitle = require('readTitle');
const getReferrerUrl = require('getReferrerUrl');
const isConsentGranted = require('isConsentGranted');
const addConsentListener = require('addConsentListener');
const templateStorage = require('templateStorage');
const JSON = require('JSON');
const getQueryParameters = require('getQueryParameters');
const getContainerVersion = require('getContainerVersion');
const copyFromDataLayer = require('copyFromDataLayer');
const copyFromWindow = require('copyFromWindow'); 
const Object = require('Object');
const generateRandom = require('generateRandom');

// ------------------------------------------------------------------------------------------------------------------------------------------------------

const config = data.config_variable;

const hostname = getUrl('host');
const referrer_hostname = getReferrerUrl('host');

// External scripts
const library_path = 'https://' + hostname + config.custom_library_location;
const script_url = (config.load_main_library_from_custom_location) ? library_path + '/nameless_analytics.min.js' : 'https://cdn.jsdelivr.net/gh/tommasomoretti/nameless-analytics-client-side-tracker-tag@main/nameless_analytics.js';
const ua_parser_url = (config.load_main_library_from_custom_location) ? library_path + '/ua-parser.min.js' : 'https://cdn.jsdelivr.net/npm/ua-parser-js/src/ua-parser.min.js';

const timestamp = getTimestampMillis();
const datalayer = copyFromWindow('dataLayer');
const datalayer_event_name = copyFromDataLayer('event', 2);
const datalayer_unique_event_id = copyFromDataLayer('gtm.uniqueEventId', 2);

// Logs
let enable_logs = false;

if (config.enable_logs) {
  if (config.enable_logs_debug_mode_only) {
    enable_logs = getContainerVersion().debugMode === true;
  } else {
    enable_logs = true;
  }

  if (enable_logs && data.disable_this_log) {
    enable_logs = false;
  }
}

const respect_consent_mode = config.respect_consent_mode;

const event_name = (data.event_type == 'standard') ? data.standard_event_name : data.custom_event_name;
const pv_event_name = (config.change_default_page_view_event_name) ? config.page_view_event_name : 'gtm.js';
const vpv_event_name = (config.change_default_virtual_page_view_event_name) ? config.virtual_page_view_event_name : 'gtm.historyChange';

const utm_source = (config.set_custom_utm_parameters_names) ? getQueryParameters(config.custom_source_name) : getQueryParameters('utm_source');
const utm_campaign = (config.set_custom_utm_parameters_names) ? getQueryParameters(config.custom_campaign_name) : getQueryParameters('utm_campaign');
const utm_id = (config.set_custom_utm_parameters_names) ? getQueryParameters(config.custom_id_name) : getQueryParameters('utm_id');
const utm_term = (config.set_custom_utm_parameters_names) ? getQueryParameters(config.custom_term_name) : getQueryParameters('utm_term');
const utm_content = (config.set_custom_utm_parameters_names) ? getQueryParameters(config.custom_content_name) : getQueryParameters('utm_content');

// const gclid = getQueryParameters('gclid'); // Google
// const dclid = getQueryParameters('dclid'); // Google
// const gclsrc = getQueryParameters('gclsrc'); // Google
// const wbraid = getQueryParameters('wbraid'); // Google
// const gbraid = getQueryParameters('gbraid'); // Google
// const msclkid = getQueryParameters('msclkid'); // Bing
// const fbclid = getQueryParameters('fbclid'); // Facebook 
// const ttclid = getQueryParameters('ttclid'); // TikTok 
// const twclid = getQueryParameters('twclid'); // X
// const _pin_click_id = getQueryParameters('_pin_click_id'); // Pinterest
// const li_fat_id = getQueryParameters('li_fat_id'); // Linkedin

const source = (referrer_hostname == hostname) ? null : ((utm_source) ? utm_source : ((referrer_hostname == '') ? 'direct' : referrer_hostname));
const campaign = utm_campaign || null;
// const campaign = utm_campaign || gclid || dclid || gclsrc || wbraid || gbraid || msclkid || fbclid || ttclid || twclid || _pin_click_id || li_fat_id || null;
const campaign_id = utm_id || null;
const campaign_term = utm_term || null;
const campaign_content = utm_content || null;

const alphanumeric_page_id = generate_alphanumeric();
const alphanumeric_event_id = generate_alphanumeric();
const cross_domain_id = getQueryParameters('na_id');

if(enable_logs){log('NAMELESS ANALYTICS');}
if(enable_logs){log('TRACKER TAG CONFIGURATION');}

if(!config.is_na_config_variable){
  if(enable_logs){log('  🔴 Tracker configuration error:', event_name, 'event has invalid Nameless Analytics Client-Side tracker configuration variable.');}
  data.gtmOnFailure();
  return;
}

// Load external libraries
if (queryPermission('inject_script', ua_parser_url)) {
  injectScript(
    ua_parser_url, 
    () => { //Injection succeed
        
      // Inject main script
      if (queryPermission('inject_script', script_url)) {
        injectScript(
          script_url,
          () => { // Injection succeed
            
            const endpoint_domain_name = config.endpoint_domain_name;            
            const endpoint_path = config.endpoint_path;
            const full_endpoint = 'https://' + endpoint_domain_name + endpoint_path;
            
            send_request(full_endpoint);  
          },
          () => { // External script not loaded
            if(enable_logs){log('  🔴 Main script not loaded');}
            data.gtmOnFailure();
          }, script_url // cache the external js
        );
      } else { // Incorrect script path
        if(enable_logs){log('  🔴 Main script, incorrect path');}
        data.gtmOnFailure();
      }
    },
    () => { // External script not loaded
      if(enable_logs){log('    🔴 UA parser script not loaded');}
      data.gtmOnFailure();
    }, ua_parser_url // cache the external js
  );
} else { // Incorrect script path
  if(enable_logs){log('    🔴 UA parser script, incorrect path');}
  data.gtmOnFailure();
} 


// ------------------------------------------------------------------------------------------------------------------------------------------------------


// Send request
function send_request(full_endpoint){
  // Enable cross-domain
  if(enable_logs){log('  👉 Enable cross-domain tracking?', (config.enable_cross_domain_tracking) ? 'Yes' : 'No');}
  if (config.enable_cross_domain_tracking) {
    set_cross_domain_listener(full_endpoint);
  }
  
  // Check if respect consent mode
  if(enable_logs){log('  👉 Respect consent choises? ' + ((respect_consent_mode) ? 'Yes' : 'No'));}
  
  // Respect consent mode
  if(respect_consent_mode){
    if(enable_logs){log('    👉 Checking consent mode...');}
    
    const consent_type = callInWindow('get_last_consent_values').consent_type;
    
    // Check if consent mode is present
    if(consent_type == 'Consent mode not present'){
      if(enable_logs){log('      🔴 Consent mode not present. Request aborted.');}
      data.gtmOnSuccess();
    } else if (consent_type == 'Default' || consent_type == 'Update') {
      // Consent denied
      if (!isConsentGranted("analytics_storage")){            
        if(enable_logs){log('      🔴 analytics_storage denied');}
        
        var consent_listener_called = false;
        
        // Add consent listener
        addConsentListener("analytics_storage", (consent_type, consent_status) => {        
          // When consent is denied  
          if (consent_listener_called || !consent_status) {
            return; 
          }
  
          // When consent is granted
          consent_listener_called = true;
                  
          if(enable_logs){log('      🟢 analytics_storage granted');}
          
          // Send pending requests when consent is granted
          if(queryPermission('access_globals', 'execute', 'send_queued_requests')) {
            callInWindow('send_queued_requests', full_endpoint, build_payload(), data, enable_logs, config.add_page_status_code);
          }
        });
        
      // Consent granted  
      } else if(isConsentGranted("analytics_storage")) {
        if(enable_logs){log('      🟢 analytics_storage granted');}
              
        // Send requests
        if(queryPermission('access_globals', 'execute', 'send_queued_requests')) {
          callInWindow('send_queued_requests', full_endpoint, build_payload(), data, enable_logs, config.add_page_status_code);
        }
      }
    }
    
  // Do not respect consent mode
  } else {   
    // Send requests
    if(queryPermission('access_globals', 'execute', 'send_queued_requests')) {
      callInWindow('send_queued_requests', full_endpoint, build_payload(), data, enable_logs, config.add_page_status_code);
    }
  }
}


// ------------------------------------------------------------------------------------------------------------------------------------------------------


// Set cross-domain listener
function set_cross_domain_listener(full_endpoint) {
  var cross_domain_listener_status = templateStorage.getItem('cross_domain_listener') || false;
  const domains = config.cross_domain_domains.map(obj => obj.domain);
  
  if (!cross_domain_listener_status) {
    if(queryPermission('access_globals', 'execute', 'set_cross_domain_listener')) {
      callInWindow('set_cross_domain_listener', full_endpoint, domains, respect_consent_mode, enable_logs);
      templateStorage.setItem('cross_domain_listener', true);

      if(enable_logs){log('    👉 Cross-domain enabled for this domains:', domains.join(', '));}
    }
  }
}


// ------------------------------------------------------------------------------------------------------------------------------------------------------


// Build the payload
function build_payload(){  
  // Save event info in template storage
  const event_storage_name = '_nameless_analytics';
  const current_event_storage_value = JSON.parse(templateStorage.getItem(event_storage_name));

  set_event_data_in_template_storage(event_storage_name, current_event_storage_value);
  
  const updated_event_storage_value = JSON.parse(templateStorage.getItem(event_storage_name));

  const user_info = {};
  const session_info = {};
  const event_info = updated_event_storage_value.pop();
        
  const payload = {};
    
  payload.event_name = event_name;
  payload.event_id = event_info.event_id;
  Object.delete(event_info, 'event_id');
    
  payload.event_timestamp = timestamp;
  payload.event_origin = 'Website';
  
  
  // DATALAYER DATA
  // Add current dataLayer state (configuration variable)
  if(config.add_current_datalayer_state){
    let datalayer_def = [];
    let found = false;
  
    for (let item of datalayer) {
      if (found) break;
      if (typeof item === "object" && item["gtm.uniqueEventId"] === datalayer_unique_event_id) {
        found = true;
      }
      datalayer_def.push(item);
    }
    payload.datalayer = datalayer_def;
  }
  
  
  // ECOMMERCE DATA
  // Add ecommerce data from dataLayer or custom variable
  if(data.add_ecommerce) {
    if(data.ecommerce_method == 'from_datalayer'){
      payload.ecommerce = copyFromDataLayer('ecommerce', 2);
    } else {
      payload.ecommerce = data.ecommerce_custom_variable || null;
    }
  }
  
  
  // USER DATA
  // Add user id (configuration variable)
  if(config.add_user_id){user_info.user_id = config.user_id;}
  
  // Add user parameters (configuration variable)
  if(config.add_user_params){
    const config_user_params = config.user_params;
    
    if(config_user_params != undefined){
      for (let i = 0; i < config_user_params.length; i++) {
        const param_name = config_user_params[i].param_name;
        const param_value = config_user_params[i].param_value;
        
        user_info[param_name] = param_value;
      }
    }
  }
  
  // Add user info to payload
  payload.user_data = user_info;

  
  // SESSION DATA
  // Add session parameters (configuration variable)
  if(config.add_session_params){
    const config_session_params = config.session_params;
    
    if(config_session_params != undefined){
      for (let i = 0; i < config_session_params.length; i++) {
        const param_name = config_session_params[i].param_name;
        const param_value = config_session_params[i].param_value;
        
        session_info[param_name] = param_value;
      }
    }
  }
  
  // Add session info to payload
  payload.session_data = session_info;
  
  
  // EVENT DATA
  // Add event parameters from dataLayer (tag fields)
  if(data.add_parameters_from_dataLayer){
    const current_event_pushes = datalayer.filter(item => item.event === datalayer_event_name);
    const last_current_event_push = current_event_pushes.length > 0 ? current_event_pushes[current_event_pushes.length - 1] : null;
    
    for (var key of Object.keys(last_current_event_push)) {
      if (key != 'event' && key != 'gtm.start' && key != 'gtm.uniqueEventId' && key != 'event_id' && key != 'page_id' && key != 'source' && key != 'campaign' && key != 'campaign_id' && key != 'campaign_term' && key != 'campaign_content' && key != 'ecommerce') {
        event_info[key] = last_current_event_push[key];
      }
    }
  } 
  
  // Add common event parameters (configuration variable)
  if(config.add_common_event_params){
    const config_event_params = config.common_event_params;
    
    if(config_event_params != undefined){
      for (let i = 0; i < config_event_params.length; i++) {
        const param_name = config_event_params[i].param_name;
        const param_value = config_event_params[i].param_value;
        
        event_info[param_name] = param_value;
      } 
   }
  }
  

  // PAGE DATA
  // Add page category (configuration variable)
    event_info.page_category = config.page_category;
  
  // Add page data if virtual page view event name != gtm.historyChange
  if (config.page_title != undefined && config.page_location != undefined) {
    event_info.page_title = config.page_title;
    event_info.page_location = config.page_location;
    event_info.page_fragment = config.page_fragment;
    event_info.page_query = config.page_query;
    event_info.page_extension = config.page_extension;
  }
     
  
  // Add event parameters (tag fields)
  if (data.add_parameters) {
    const event_params = data.add_event_params;
    
    if (event_params !== undefined) {
      for (let i = 0; i < event_params.length; i++) {
        const param_name = event_params[i].param_name;
        const param_value = event_params[i].param_value;
        
        event_info[param_name] = param_value;
      }
    }
  }
  
  // Remove event data (tag fields)
  if (data.remove_parameters) {
    const event_params = data.remove_event_params;
    
    if (event_params !== undefined) {
      for (let i = 0; i < event_params.length; i++) {
        const param_name = event_params[i].param_name;
        
        Object.delete(event_info.event_data, param_name);
      }
    }
  } 
  
  // Add event info to payload
  payload.event_data = event_info;
  
  
  // CONSENT DATA
  // Add consent data
  const consents = callInWindow('get_last_consent_values');
  
  const consent_info = {
    consent_type: consents.consent_type,
    respect_consent_mode: (respect_consent_mode) ? 'Yes' : 'No',
    ad_user_data: (consents.ad_user_data) ? 'Granted' : ((consents.ad_user_data == null) ? null : 'Denied'),
    ad_personalization: (consents.ad_personalization) ? 'Granted' : ((consents.ad_personalization == null) ? null : 'Denied'),
    ad_storage: (consents.ad_storage) ? 'Granted' : ((consents.ad_storage == null) ? null : 'Denied'),
    analytics_storage: (consents.analytics_storage) ? 'Granted' : ((consents.analytics_storage == null) ? null : 'Denied'),
    functionality_storage: (consents.functionality_storage) ? 'Granted' : ((consents.functionality_storage == null) ? null : 'Denied'),
    personalization_storage: (consents.personalization_storage) ? 'Granted' : ((consents.personalization_storage == null) ? null : 'Denied'),
    security_storage: (consents.security_storage) ? 'Granted' : ((consents.security_storage == null) ? null : 'Denied')
  };
  
  // Add consent info to payload
  payload.consent_data = consent_info;
  
  return payload;
}


// ------------------------------------------------------------------------------------------------------------------------------------------------------


// Save event info in template storage
function set_event_data_in_template_storage(storage_name, storage_value) {
  const channel_grouping = (queryPermission('access_globals', 'execute', 'get_channel_grouping')) ? callInWindow('get_channel_grouping', source, campaign): null;
    
  if (datalayer_event_name == pv_event_name || datalayer_event_name == vpv_event_name) {  
    const page_id = alphanumeric_page_id;
    const event_id = page_id + "_" + alphanumeric_event_id;
  
    const event_info = [{
      event_id: event_id,
      event_type: (datalayer_event_name == pv_event_name) ? 'page_view' : 'virtual_page_view',
      channel_grouping: channel_grouping,
      source: source,
      campaign: campaign,
      campaign_id: campaign_id,
      campaign_term: campaign_term,
      campaign_content: campaign_content,
      page_id: page_id,
      page_title: readTitle(),
      page_hostname_protocol: getUrl('protocol'),
      page_hostname: hostname,
      page_location: getUrl('path'),
      page_fragment: getUrl('fragment') || null,
      page_query: getUrl('query') || null,
      page_extension: getUrl('extension') || null,
      page_referrer: (getReferrerUrl() == '') ? null : getReferrerUrl(),
      cs_container_id: getContainerVersion().containerId,
      cross_domain_id: (datalayer_event_name == pv_event_name) ? cross_domain_id : null
    }];
        
    templateStorage.setItem(storage_name, JSON.stringify(event_info));
  } else if (!storage_value) {
    if (event_name == 'page_view') {
      if(enable_logs){log('🔴 Page view fired on wrong event. Change default JavaScript page view event names in Nameless Analytics Client-Side tracker configuration variable. Request aborted.');}   
    } else {
      if(enable_logs){log('🔴', event_name, 'fired before a page view event. The first event on a page view ever must be page_view. Request aborted.');}
    }
    data.gtmOnSuccess();
  } else {
    const current_event_info = storage_value.pop();
    const full_page_id = current_event_info.page_id;
    const event_id = full_page_id + "_" + alphanumeric_event_id;
    
    const event_info = [{
      event_id: event_id,
      event_type: 'event',
      channel_grouping: channel_grouping,
      source: source,
      campaign: campaign,
      campaign_id: campaign_id,
      campaign_term: campaign_term,
      campaign_content: campaign_content,
      page_id: full_page_id,
      page_title: readTitle(),
      page_hostname_protocol: getUrl('protocol'),
      page_hostname: hostname,
      page_location: getUrl('path'),
      page_fragment: getUrl('fragment') || null,
      page_query: getUrl('query') || null,
      page_extension: getUrl('extension') || null,
      page_referrer: (getReferrerUrl() == '') ? null : getReferrerUrl(),     
      cs_container_id: getContainerVersion().containerId,
    }];
        
    templateStorage.setItem(storage_name, JSON.stringify(event_info));
  }
}

// Generate random alphanumeric ID 
function generate_alphanumeric() {
  var max_length = 15;
  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  var alphanumeric_id = '';
  for (var i = 0; i < max_length; i++) {
    alphanumeric_id += chars.charAt(generateRandom(0, chars.length));
  }
  return alphanumeric_id;
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://tommasomoretti.com/"
              },
              {
                "type": 1,
                "string": "https://namelessanalytics.com/"
              },
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/gh/tommasomoretti/nameless-analytics-client-side-tracker-tag@main/nameless_analytics.js"
              },
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/npm/ua-parser-js/src/ua-parser.min.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "send_queued_requests"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "get_channel_grouping"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "set_cross_domain_listener"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "get_last_consent_values"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "get_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "get_all_data_from_dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_title",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_referrer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_template_storage",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedKeys",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 25/09/2025, 13:53:17


